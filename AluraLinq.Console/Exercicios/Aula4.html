<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style type="text/css">
        body {
            margin: 20px 80px 20px 80px;
        }

        hr {
            border: none;
            height: 1px;
            /* Set the hr color */
            color: #333; /* old IE */
            background-color: #333; /* Modern Browsers */
        }

        .checkbox span {
            margin: 0 10px 0 10px;
            background-color: lightpink;
        }

        .checkbox:nth-child(4) span {
            margin: 0 10px 0 10px;
            background-color: lightgreen;
        }

        h4 {
            text-decoration: underline;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1><strong>Aula 4</strong></h1>

    <hr />

    <div class="MultipleChoice">
        <h3>Substituindo Joins Em Consultas Linq to Entities</h3>
        <p>
            Considere o seguinte diagrama do modelo Entity Framework (AluraTunesEntities.edmx) gerado a partir de um 
            banco de dados:
        </p>
        <pre>
AluraTunesEntities.edmx

Entidades        ║    Album                     Artista
=================╬=========================================
Propriedades     ║  AlbumId           ┌------ArtistaId (PK)
                 ║  Nome              |      Nome
                 ║  ArtistaId (FK)----┘
=================╬=========================================
Propriedades de  ║  Artista
Navegação        ║
        </pre>
        <p>Uma consulta Linq to Entities é criada para trazer os álbuns a partir desse modelo, como segue:</p>
        <pre>
var query = from alb in contexto.Albums
join art in contexto.Artistas 
    on alb.ArtistaId equals art.ArtistaId
where art.Nome == textoBusca
select alb;
        </pre>
        <p>
            De acordo com o modelo descrito no começo do exercício, como a consulta acima poderia ser reescrita
            de forma alternativa porém gerando a mesma consulta Linq?
        </p>
        <form>
            <div class="checkbox">
                <label><input type="checkbox" value="">
                    <pre>
var query = from art in contexto.Artistas
where art.Album.Nome == "Led Zeppelin"
select alb;
                    </pre>                
                </label>
                <span>A consulta está tentando acessar uma propriedade de navegação inexistente (Artista.Album).</span>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" value="">
                    <pre>
var query = from alb in Albums
where alb.Artista.Nome == "Led Zeppelin"
select alb;
                    </pre>                
                </label>
                <span>
                    A consulta está tentando acessar um objeto <code>Albums</code>, em vez de acessar a entidade
                    <code>contexto.Albums</code> como na consulta original.
                </span>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" value="">
                    <pre>
var query = from alb in contexto.Albums
select alb;
                    </pre>    
                </label>
                <span>A sintaxe está correta, porém essa consulta não está filtrando os dados como a
                consulta original.</span>
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox" value="" checked="checked">
                    <pre>
var query = from alb in contexto.Albums
where alb.Artista.Nome == "Led Zeppelin"
select alb;
                    </pre>
                </label>
                <span>CORRETO: a consulta está trazendo os dados da entidade <code>contexto.Albums</code>
                e filtrando o resultado pela propriedade <code>Nome</code> da propriedade de navegação
                <code>alb.Artista</code>.</span>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" value="">
                    <pre>
var query = from alb in contexto.Albums
on alb.Artista.Nome == "Led Zeppelin"
select alb;
                    </pre>
                </label>
                <span>A sintaxe está incorreta, pois a palavra "on" só pode ser usada dentro de uma cláusula
                <code>join</code>.</span>
            </div>
        </form>
    </div>
    <hr />

    <div class="MultipleChoice">
        <h3>Entendendo Propriedades de Navegação</h3>
        <p>
            Quais as vantagens de se usar propriedades de navegação no lugar de joins numa consulta Linq?
        </p>
        <form>
            <div class="checkbox">
                <label><input type="checkbox" value="">Não existe vantagem nenhuma, apenas desvantagem, pois
                o uso da propriedade de navegação deixa a consulta mais lenta.</label>
                <span>
                    Não há redução de desempenho, pois a consulta SQL gerada para o servidor de banco de dados
                    é a mesma.
                </span>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" value="">Não existe vantagem nem desvantagem.</label>
                <span>
                    Existe a vantagem de que a consulta com propriedades de navegação fica mais limpa, 
                    mais fácil de ler e de entender.
                </span>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" value="">A consulta coloca os resultados num cache que pode
                ser reutilizado nas próximas execuções.</label>
                <span>A propriedade de navegação não coloca o resultado no cache.</span>
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox" value="" checked="checked">
                    A consulta fica mais legível e simples de entender.
                </label>
                <span>CORRETO: os dois tipos de abordagem geram a mesma consulta, porém a consulta com propriedades
                de navegação fica mais limpa, mais fácil de ler e de entender.</span>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" value="">A consulta fica mais rápida.</label>
                <span>Não há melhoria de desempenho, pois a consulta SQL gerada para o servidor de banco de dados
                é a mesma.</span>
            </div>
        </form>
    </div>
    <hr />

    <div class="CallToAction">
        <h3>Propriedades de Navegação em Linq to Objects?</h3>
        <p>Considere uma aplicação que possui as seguintes classes:</p>
        <pre>
class Genero
{
    public int Id { get; set; }
    public string Nome { get; set; }
}

class Musica
{
    public int Id { get; set; }
    public string Nome { get; set; }
    public int GeneroId { get; set; }
}            
        </pre>
        <p>Essa aplicação declara e preenche duas listas dos tipos de classe acima, da seguinte maneira:</p>
        <pre>
List&lt;Genero&gt; generos = new List&lt;Genero&gt;
{
    new Genero { Id = 1, Nome = "Rock" },
    new Genero { Id = 2, Nome = "Reggae" },
    new Genero { Id = 3, Nome = "Rock Progressivo" },
    new Genero { Id = 4, Nome = "Jazz" },
    new Genero { Id = 5, Nome = "Punk Rock" },
    new Genero { Id = 6, Nome = "Classica" }
};

List&lt;Musica&gt; musicas = new List&lt;Musica&gt;
{
    new Musica { Id = 1, Nome = "Sweet Child O'Mine", GeneroId = 1 },
    new Musica { Id = 2, Nome = "I Shot The Sheriff", GeneroId = 2 },
    new Musica { Id = 3, Nome = "Danúbio Azul", GeneroId = 6 }
};
        </pre>

        <p>
            Suponha que agora você precise criar uma consulta que traga o id da música, o nome da música e o nome do gênero musical.
            Então você implementa a consulta conforme abaixo:
        </p>
        <pre>
var query = from m in musicas
join g in generos on m.GeneroId equals g.Id
select new
{
    MusicaId = m.Id,
    Musica = m.Nome,
    Genero = g.Nome
};
        </pre>
        <p>Uma colega vê o seu código e pergunta se você não poderia reescrever sua consulta, substituindo
        o join por uma propriedade de navegação. O que você responderia? Justifique sua resposta.</p>
    </div>
    <hr />

    <div class="CallToAction">
        <h3>[MODELO] Dê um nome expressivo ao seu exercicio SEM RESPOSTA</h3>
        <p>
            [MODELO] Considerando que essa é uma pergunta pertinente à aula, e considerando que
            o cenário que descrevemos, faça isso e depois aquilo, utilizando como base o o cenário que vimos.
        </p>
    </div>
    <hr />

    <div class="CallToAction">
        <h3>[MODELO] Dê um nome expressivo ao seu exercicio SEM RESPOSTA</h3>
        <p>
            [MODELO] Considerando que essa é uma pergunta pertinente à aula, e considerando que
            o cenário que descrevemos, faça isso e depois aquilo, utilizando como base o o cenário que vimos.
        </p>
    </div>

</body>
</html>